#!/usr/bin/env bash
set -euo pipefail

dir="${1:-.}"
dir="${dir%/}"

cutoff=$(date -d '-5 days' +%Y%m%d)

# find newest folder (glob + sort)
latest=$(printf "%s\n" "$dir"/[0-9]* | sort -r | head -n1)

for entry in "$dir"/[0-9]*; do
  [[ -d $entry ]] || continue
  day=$(basename "$entry")
  day=${day:0:8}

  if (( day < cutoff )); then
    echo "Removing release history $entry"
    rm -rf "$entry"
  elif [[ $entry != "$latest" ]]; then
    echo "Keeping release history $entry, removing vendor"
    rm -rf "$entry/vendor"
  fi
done
